!function(e){var t={};function n(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(o,a,function(t){return e[t]}.bind(null,a));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=7)}([function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n=e[1]||"",o=e[3];if(!o)return n;if(t&&"function"==typeof btoa){var a=(r=o,i=btoa(unescape(encodeURIComponent(JSON.stringify(r)))),c="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i),"/*# ".concat(c," */")),s=o.sources.map((function(e){return"/*# sourceURL=".concat(o.sourceRoot||"").concat(e," */")}));return[n].concat(s).concat([a]).join("\n")}var r,i,c;return[n].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,o){"string"==typeof e&&(e=[[null,e,""]]);var a={};if(o)for(var s=0;s<this.length;s++){var r=this[s][0];null!=r&&(a[r]=!0)}for(var i=0;i<e.length;i++){var c=[].concat(e[i]);o&&a[c[0]]||(n&&(c[2]?c[2]="".concat(n," and ").concat(c[2]):c[2]=n),t.push(c))}},t}},function(e,t){t.song=[[[,0,262],[,0,131]],[[[1,0,15,0,22,0,27,0,31,0,10,0,17,0,22,0,26,0,12,0,19,0,24,0,27,0,7,0,14,0,19,0,22,0,8,0,15,0,20,0,24,0,3,0,10,0,15,0,19,0,8,0,15,0,20,0,24,0,10,0,17,0,22,0,26,0]],[[1,0,15,0,22,0,27,0,31,0,10,0,17,0,22,0,26,0,12,0,19,0,24,0,27,0,7,0,14,0,19,0,22,0,8,0,15,0,20,0,24,0,3,0,10,0,15,0,19,0,8,0,15,0,20,0,24,0,10,0,17,0,22,0,26,0],[,0,31,0,0,0,0,0,0,0,29,0,0,0,0,0,0,0,27,0,0,0,0,0,-1,0,26,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,22,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,26,0,0,0,0,0,0,0]],[[1,0,15,0,22,0,27,0,31,0,10,0,17,0,22,0,26,0,12,0,19,0,24,0,27,0,7,0,14,0,19,0,22,0,8,0,15,0,20,0,24,0,3,0,10,0,15,0,19,0,8,0,15,0,20,0,24,0,10,0,17,0,22,0,26,0],[,0,31,0,0,0,0,0,0,0,29,0,0,0,0,0,0,0,27,0,0,0,0,0,-1,0,26,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,22,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,26,0,0,0,0,0,0,0],[,0,15,0,0,0,0,0,0,0,14,0,0,0,0,0,0,0,12,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0]],[[1,0,15,0,22,0,27,0,31,0,10,0,17,0,22,0,26,0,12,0,19,0,24,0,27,0,7,0,14,0,19,0,22,0,8,0,15,0,20,0,24,0,3,0,10,0,15,0,19,0,8,0,15,0,20,0,24,0,10,0,17,0,22,0,26,0],[,0,27,0,0,0,31,0,0,0,34,0,0,0,32,0,0,0,31,0,0,0,27,0,0,0,31,0,0,0,0,0,29,0,27,0,0,0,24,0,0,0,27,0,0,0,31,0,0,0,32,0,0,0,36,0,0,0,34,0,0,0,0,0,32,0]],[[1,0,15,0,22,0,27,0,31,0,10,0,17,0,22,0,26,0,12,0,19,0,24,0,27,0,7,0,14,0,19,0,22,0,8,0,15,0,20,0,24,0,3,0,10,0,15,0,19,0,8,0,15,0,20,0,24,0,10,0,17,0,22,0,26,0],[,0,27,0,0,0,31,0,0,0,34,0,0,0,32,0,0,0,31,0,0,0,27,0,0,0,31,0,0,0,0,0,29,0,27,0,0,0,24,0,0,0,27,0,0,0,31,0,0,0,32,0,0,0,36,0,0,0,34,0,0,0,0,0,32,0],[,0,31,0,0,0,0,0,0,0,29,0,0,0,0,0,0,0,27,0,0,0,0,0,0,0,26,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,22,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,26,0,0,0,0,0,0,0]],[[1,0,15,0,22,0,27,0,31,0,10,0,17,0,22,0,26,0,12,0,19,0,24,0,27,0,7,0,14,0,19,0,22,0,8,0,15,0,20,0,24,0,3,0,10,0,15,0,19,0,8,0,15,0,20,0,24,0,10,0,17,0,22,0,26,0],[,0,27,0,26,0,27,0,22,0,22,0,0,0,26,0,0,0,27,0,0,0,31,0,0,0,34,0,0,0,0,0,36,0,32,0,31,0,29,0,32,0,31,0,29,0,27,0,26,0,24,0,22,0,27,0,0,0,27,0,0,0,0,0,26,0]],[[1,0,15,0,22,0,27,0,31,0,10,0,17,0,22,0,26,0,12,0,19,0,24,0,27,0,7,0,14,0,19,0,22,0,8,0,15,0,20,0,24,0,3,0,10,0,15,0,19,0,8,0,15,0,20,0,24,0,10,0,17,0,22,0,26,0],[,0,34,0,31,32,34,0,31,32,34,22,24,26,27,29,31,32,31,0,27,29,31,0,19,20,22,24,22,20,22,19,20,22,20,0,24,22,20,0,19,17,19,17,15,17,19,20,22,24,20,0,24,22,24,0,26,27,22,24,26,27,29,31,32,34]],[[1,0,15,0,22,0,27,0,31,0,10,0,17,0,22,0,26,0,12,0,19,0,24,0,27,0,7,0,14,0,19,0,22,0,8,0,15,0,20,0,24,0,3,0,10,0,15,0,19,0,8,0,15,0,20,0,24,0,10,0,17,0,22,0,26,0],[,0,34,0,27,0,31,0,34,0,34,0,36,0,34,0,32,0,31,0,0,0,0,0,31,0,31,0,32,0,31,0,29,0,27,0,25,0,24,0,25,0,27,0,0,0,22,0,0,22,27,0,25,0,24,0,25,0,27,0,0,0,26,0,0,0]]],[0,1,2,3,4,5,5,6,6,7,7],100,{title:"Canon in D",instruments:["Instrument 0","Instrument 1"],patterns:["1-Bass","5-Treble","9-Harmony","13-Exp","17-Exp/Treble","21/25-Exp2","37","53"]}]},function(e,t,n){var o=n(3),a=n(4);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var s={insert:"head",singleton:!1};o(a,s);e.exports=a.locals||{}},function(e,t,n){"use strict";var o,a=function(){return void 0===o&&(o=Boolean(window&&document&&document.all&&!window.atob)),o},s=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}(),r=[];function i(e){for(var t=-1,n=0;n<r.length;n++)if(r[n].identifier===e){t=n;break}return t}function c(e,t){for(var n={},o=[],a=0;a<e.length;a++){var s=e[a],c=t.base?s[0]+t.base:s[0],l=n[c]||0,d="".concat(c," ").concat(l);n[c]=l+1;var p=i(d),h={css:s[1],media:s[2],sourceMap:s[3]};-1!==p?(r[p].references++,r[p].updater(h)):r.push({identifier:d,updater:g(h,t),references:1}),o.push(d)}return o}function l(e){var t=document.createElement("style"),o=e.attributes||{};if(void 0===o.nonce){var a=n.nc;a&&(o.nonce=a)}if(Object.keys(o).forEach((function(e){t.setAttribute(e,o[e])})),"function"==typeof e.insert)e.insert(t);else{var r=s(e.insert||"head");if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(t)}return t}var d,p=(d=[],function(e,t){return d[e]=t,d.filter(Boolean).join("\n")});function h(e,t,n,o){var a=n?"":o.media?"@media ".concat(o.media," {").concat(o.css,"}"):o.css;if(e.styleSheet)e.styleSheet.cssText=p(t,a);else{var s=document.createTextNode(a),r=e.childNodes;r[t]&&e.removeChild(r[t]),r.length?e.insertBefore(s,r[t]):e.appendChild(s)}}function u(e,t,n){var o=n.css,a=n.media,s=n.sourceMap;if(a?e.setAttribute("media",a):e.removeAttribute("media"),s&&btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleSheet)e.styleSheet.cssText=o;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(o))}}var m=null,f=0;function g(e,t){var n,o,a;if(t.singleton){var s=f++;n=m||(m=l(t)),o=h.bind(null,n,s,!1),a=h.bind(null,n,s,!0)}else n=l(t),o=u.bind(null,n,t),a=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return o(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;o(e=t)}else a()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=a());var n=c(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var o=0;o<n.length;o++){var a=i(n[o]);r[a].references--}for(var s=c(e,t),l=0;l<n.length;l++){var d=i(n[l]);0===r[d].references&&(r[d].updater(),r.splice(d,1))}n=s}}}},function(e,t,n){"use strict";n.r(t);var o=n(0),a=n.n(o)()(!0);a.push([e.i,"html,body{overflow:hidden;width:100%;height:100%;margin:0;padding:0}#renderCanvas{width:100%;height:100%;touch-action:none}\n","",{version:3,sources:["/mnt/c/Users/alex/dev/tiny-tower-defense/src/style.scss"],names:[],mappings:"AAAA,UACQ,eAAgB,CAChB,UAAc,CACd,WAAc,CACd,QAAW,CACX,SAAW,CACd,cAGG,UAAc,CACd,WAAc,CACd,iBAAkB",file:"style.scss",sourcesContent:["html, body {\r\n        overflow: hidden;\r\n        width   : 100%;\r\n        height  : 100%;\r\n        margin  : 0;\r\n        padding : 0;\r\n    }\r\n\r\n    #renderCanvas {\r\n        width   : 100%;\r\n        height  : 100%;\r\n        touch-action: none;\r\n    }"]}]),t.default=a},function(e,t){zzfx=(...e)=>zzfxP(zzfxG(...e)),zzfxP=(...e)=>{let t=zzfxX.createBufferSource(),n=zzfxX.createBuffer(e.length,e[0].length,zzfxR);return e.map((e,t)=>n.getChannelData(t).set(e)),t.buffer=n,t.connect(zzfxX.destination),t.start(),t},zzfxG=(e=1,t=.05,n=220,o=0,a=0,s=.1,r=0,i=1,c=0,l=0,d=0,p=0,h=0,u=0,m=0,f=0,g=0,w=1,M=0,B=0)=>{let x,y,b=2*Math.PI,C=c*=500*b/zzfxR**2,v=(0<m?1:-1)*b/4,P=n*=(1+2*t*Math.random()-t)*b/zzfxR,A=[],S=0,I=0,O=0,T=1,z=0,L=0,N=0;for(o=99+zzfxR*o,M*=zzfxR,a*=zzfxR,s*=zzfxR,g*=zzfxR,l*=500*b/zzfxR**3,m*=b/zzfxR,d*=b/zzfxR,p*=zzfxR,h=zzfxR*h|0,y=o+M+a+s+g|0;O<y;A[O++]=N)++L%(100*f|0)||(N=r?1<r?2<r?3<r?Math.sin((S%b)**3):Math.max(Math.min(Math.tan(S),1),-1):1-(2*S/b%2+2)%2:1-4*Math.abs(Math.round(S/b)-S/b):Math.sin(S),N=(h?1-B+B*Math.sin(2*Math.PI*O/h):1)*(0<N?1:-1)*Math.abs(N)**i*e*zzfxV*(O<o?O/o:O<o+M?1-(O-o)/M*(1-w):O<o+M+a?w:O<y-g?(y-O-g)/s*w:0),N=g?N/2+(g>O?0:(O<y-g?1:(y-O)/g)*A[O-g|0]/2):N),x=(n+=c+=l)*Math.sin(I*m-v),S+=x-x*u*(1-1e9*(Math.sin(O)+1)%2),I+=x-x*u*(1-1e9*(Math.sin(O)**2+1)%2),T&&++T>p&&(n+=d,P+=d,T=0),!h||++z%h||(n=P,c=C,T=T||1);return A},zzfxV=.3,zzfxR=44100,zzfxX=new(top.AudioContext||webkitAudioContext)},function(e,t){
//! ZzFXM (v2.0.3) | (C) Keith Clark | MIT | https://github.com/keithclark/ZzFXM
zzfxM=(e,t,n,o=125)=>{let a,s,r,i,c,l,d,p,h,u,m,f,g,w,M,B=0,x=[],y=[],b=[],C=0,v=0,P=1,A={},S=zzfxR/o*60>>2;for(;P;C++)x=[P=p=m=g=0],n.map((o,m)=>{for(d=t[o][C]||[0,0,0],P|=!!t[o][C],M=g+(t[o][0].length-2-!p)*S,w=m==n.length-1,s=2,i=g;s<d.length+w;p=++s){for(c=d[s],h=s==d.length+w-1&&w||u!=(d[0]||0)|c|0,r=0;r<S&&p;r++>S-99&&h?f+=(f<1)/99:0)l=(1-f)*x[B++]/2||0,y[i]=(y[i]||0)-l*v+l,b[i]=(b[i++]||0)+l*v+l;c&&(f=c%1,v=d[1]||0,(c|=0)&&(x=A[[u=d[B=0]||0,c]]=A[[u,c]]||(a=[...e[u]],a[2]*=2**((c-12)/12),c>0?zzfxG(...a):[])))}g=M});return[y,b]}},function(e,t,n){"use strict";n.r(t);n(2);const{Vector3:o,Color3:a,MeshBuilder:s,Mesh:r,CSG:i,StandardMaterial:c,SolidParticleSystem:l,DynamicTexture:d}=BABYLON,p=(e,t,n,a)=>new o(e*(a=a||1/3),t*a,n*a),h=e=>{const t=new c("Material-Shape");return t.diffuseColor=e,t},u=e=>{const{drawings:t,color:n}=e,[c,l,d]=n.split(","),u=h(new a(c,l,d)),m=["x","y","z"],f=[];if(t.forEach((e,t)=>{if(!e.polygons.length)return null;if(e.mirror){const t=[];e.polygons.forEach(e=>{const n=[];for(let t=e.length-1;t>=0;t--){const[o,a]=e[t];n.push([64-o,a])}t.push(n)}),e.polygons.push(...t)}const n=(e=>{const t=[],n=[p(0,0,-1,.5),p(0,0,1,.5)];e.forEach(e=>{const o=e.map(e=>{const[t,n]=e;return p(t-32,n-32,0,1/64)});o.push(o[0]);const a=s.ExtrudeShape("star",{shape:o,path:n,cap:r.CAP_ALL,updatable:!0});t.push(a)});return r.MergeMeshes(t,!0)})(e.polygons);"x"===m[t]&&n.rotate(o.Up(),-Math.PI/2),"y"===m[t]&&n.rotate(o.Right(),Math.PI/2),f.push(n)}),!f.length)return null;let g=null;f.forEach(e=>{const t=i.FromMesh(e);g?g.intersectInPlace(t):g=t});const w=g.toMesh("Result-Mesh",u,null,!0);return f.forEach(e=>e.dispose()),w},m=(e,t,n)=>{const{size:a,blocks:r,pickable:i}=e,[c,d,p]=a,[h,u,m]=r,f=h.padStart(p*d,"0").split(""),g=u.padStart(c*p,"0").split(""),w=m.padStart(c*d,"0").split(""),M=1/c,B=new l(e.name+"-SPS",n,{isPickable:i,useModelMaterial:!0}),x=s.CreateBox("b",{size:M});B.addShape(x,c*d*p),x.dispose();const y=B.buildMesh();return y.metadata={sps:B},y.position.y=1,B.initParticles=function(){for(let e=0;e<B.nbParticles;e++){const n=B.particles[e];n.props={state:1},t&&(n.props.correctState=t[e].props.state);const a=e%c,s=Math.floor(e/d)%p,r=Math.floor(Math.floor(e/c)/d);n.position=new o(M*(a+.5)-.5,M*(s+.5)-.5,M*(r+.5)-.5);const i=1===parseInt(f[s*p+r]),l=1===parseInt(g[r*c+a]),h=1===parseInt(w[s*c+a]);n.props.state=i&&l&&h?1:0,n.scaling=1===n.props.state?o.One():o.Zero()}},B.initParticles(),B.setParticles(),B.refreshVisibleSize(),y},f=e=>{const t=((e,t,n)=>{const o=s.CreateBox("Start-Button",{size:e},n),a=new d("TextTexture",{width:t,height:t},n),r=new c("TextMaterial",n);return r.diffuseTexture=a,r.diffuseTexture.hasAlpha=!0,o.material=r,o})(.25,512),{material:n}=t,o=n.diffuseTexture,a=o.getContext();a.fillStyle="green",a.fillRect(0,0,512,512),a.save(),a.lineWidth=64,a.lineCap="round",a.translate(256,256),a.beginPath();let r=0;return a.moveTo(128*Math.cos(r),128*Math.sin(r)),r=2/3*Math.PI,a.lineTo(128*Math.cos(r),128*Math.sin(r)),r=4/3*Math.PI,a.lineTo(128*Math.cos(r),128*Math.sin(r)),a.closePath(),a.stroke(),a.restore(),o.update(),t},g=(e,t)=>{const n=e.width||512,o=e.height||341,a=s.CreatePlane("TextMesh",{width:1,height:o/n},t),r=new d("TextTexture",{width:n,height:o},t),i=new c("TextMaterial",t);return i.diffuseTexture=r,i.diffuseTexture.hasAlpha=!0,a.material=i,a.appendText=function(e){this.text=`${e}|${this.text}`,this.setText(this.text)},a.setText=function(e){this.text=e;const t=r.getContext();if(t.fillStyle="transparent",t.clearRect(0,0,n,o),""===e)return void r.update();t.beginPath(),t.moveTo(n,o),t.arcTo(0,o,0,0,64),t.arcTo(0,0,n,0,64),t.arcTo(n,0,n,o,64),t.arcTo(n,o,0,o,64),t.fillStyle="black",t.fill(),t.font="64px Helvetica",t.fillStyle="white";e.split("|").forEach((e,o)=>{const a=e.split("^");a.forEach((e,s)=>{t.fillStyle="#ffffff",(2===s||e.includes("mistake"))&&(t.fillStyle="#ff3333"),t.fillText(e,75+(n-150)/a.length*s,100+96*o)})}),r.update()},a},w={color:"1,1,1",drawings:[{polygons:[]},{polygons:[[[63,32],[0,32],[32,29]]]},{polygons:[[[32,13],[0,0],[32,5]]],mirror:!0}]},M={name:"Cat",size:[8,8,8],blocks:["0111111100111101001111010011100100110000111000000110000000100000","0001100001011010011111100111111000111100000110000000111100000001","0111111101111111001111010011110100011000001111000011110000100100"],colors:["99,35,7","205,144,87","243,221,198","205,144,87","99,35,7","243,221,198","205,144,87","99,35,7"]},B={name:"Ship",size:[8,8,8],blocks:["0011111011111111001001110010010000100100001001000010010000100100","0001000000111000011111110011101100111011011111110011100100111000","0011101100111100001110000001000001111100011111000111110000010000"],colors:["99,35,7","144,70,23","144,70,23","99,35,7","243,221,198","203,181,158","243,221,198","99,35,7"]},x={name:"Squiggle",size:[8,8,8],color:"0.48,0.44,0.44",blocks:["1111111101100110110000111000000110000001110000110110011011111111","0011110001100110110110111010010110100101110110110110011000111100","1111111100000011000001100001110000111000011000001100000011111111"],colors:["255,253,184","237,163,35","253,246,140","210,141,13","244,205,42","253,246,140","237,163,35","255,253,184"]},y={name:"Blank",pickable:!0,size:[8,8,8],color:"1,1,1",blocks:["1111111111111111111111111111111111111111111111111111111111111111","1111111111111111111111111111111111111111111111111111111111111111","1111111111111111111111111111111111111111111111111111111111111111"]},b={name:"Skull",size:[8,8,8],color:"1,1,1",blocks:["1110000000010000111100001111111011111111011111110111111000111100","0001100001111110111111111111111111111111011111100011110000011000","0011110000100100001111000111111011111111111111110111111000111100"],colors:["29,182,186","244,159,12","255,197,9","222,26,98","171,206,30","29,182,186","244,159,12","222,26,98"]},C={name:"Links",size:[8,8,8],colors:["83,52,25","164,82,9","255,102,0","83,52,25","255,204,51","255,102,0","164,82,9","255,204,51"],blocks:["0001100000011000000110001111111111111111000110000001100000011000","0111000011011000100010001001111110011111100010001101100001110000","0000111000011011000100011111100111111001000100010001101100001110"]};var v=n(1);const P=[.0625,.1875,.3125,.4375,.5625,.6875,.8125,.9375],A=[new BABYLON.Color3(.019,.019,.423),new BABYLON.Color3(.047058823529411764,.6549019607843137,.8274509803921568),new BABYLON.Color3(.8313725490196079,.7215686274509804,.5254901960784314),new BABYLON.Color3(.0196078431372549,.47843137254901963,.16470588235294117),new BABYLON.Color3(.3058823529411765,.22745098039215686,.13333333333333333),new BABYLON.Color3(.5450980392156862,.3411764705882353,.16470588235294117),new BABYLON.Color3(1,1,1)],S=function(e){const t=new BABYLON.NodeMaterial("node"),n=new BABYLON.InputBlock("position");n.setAsAttribute("position");const o=new BABYLON.VectorSplitterBlock("VectorSplitter"),a=new BABYLON.VectorMergerBlock("VectorMerger"),s=new BABYLON.TransformBlock("WorldPos");s.complementZ=0,s.complementW=1;const r=new BABYLON.InputBlock("World");r.setAsSystemValue(BABYLON.NodeMaterialSystemValues.World);const i=new BABYLON.TransformBlock("WorldPos * ViewProjectionTransform");i.complementZ=0,i.complementW=1;const c=new BABYLON.InputBlock("ViewProjection");c.setAsSystemValue(BABYLON.NodeMaterialSystemValues.ViewProjection);const l=new BABYLON.VertexOutputBlock("VertexOutput"),d=new BABYLON.RemapBlock("Remap");d.sourceRange=new BABYLON.Vector2(-.5,.5),d.targetRange=new BABYLON.Vector2(0,1);const p=new BABYLON.GradientBlock("Gradient");p.colorSteps.push(new BABYLON.GradientBlockColorStep(0,e[0]));for(let t=0;t<P.length;t++){let n=t>=e.length?e[e.length-1]:e[t];p.colorSteps.push(new BABYLON.GradientBlockColorStep(P[t],n))}p.colorSteps.push(new BABYLON.GradientBlockColorStep(1,e[e.length-1]));const h=new BABYLON.FragmentOutputBlock("FragmentOutput");return n.output.connectTo(o.xyzIn),o.x.connectTo(a.x),o.y.connectTo(a.y),o.z.connectTo(a.z),a.xyz.connectTo(s.vector),r.output.connectTo(s.transform),s.output.connectTo(i.vector),c.output.connectTo(i.transform),i.output.connectTo(l.vector),o.y.connectTo(d.input),d.output.connectTo(p.gradient),p.output.connectTo(h.rgb),t.addOutputNode(l),t.addOutputNode(h),t.build(),t};function I(e){Object.assign(e,{startInteraction(e,t,n){this.props=this.props||{},this.props.state=0;const{correctState:o}=this.props;1===o?(this.materialIndex=1,zzfx(1,.05,1171,.01,0,.08,3,.74,0,1.9,-389,.06,0,.1,0,.1,0,1,.03,.59)):(this.scaling=BABYLON.Vector3.Zero(),zzfx(1,.05,1851,.01,0,.07,0,1.06,2.4,0,0,0,0,0,0,0,.01,.09,.03,0))},moveInteraction(e,t){},endInteraction(e,t){}})}var O=245,T=40;const{Vector3:z,Mesh:L,MeshBuilder:N,StandardMaterial:k,Color3:R}=BABYLON,E=e=>{let t="";const n=Math.floor(e/60);t+=n+":";return t+=""+Math.floor(e-60*n).toString().padStart(2,"0"),t};async function Y(e,t){const n=h(new R(1,0,0));let o;if(t.sculptures.push(e.name),e.colors){const t=e.colors.map(e=>{const t=e.split(",");return new R.FromInts(t[0],t[1],t[2])});o=S(t)}else o=S(A);const{scene:a,engine:s,xrHelper:r,xrDefault:i,myStorage:c}=t,l=new L(e.name,a);l.metadata={inProgress:!1,timer:0,counter:0,myStorage:c},l.startGame=function(){const{sculpture:t,solution:n,myStorage:o}=this.metadata,s=t.metadata.sps;for(let e=0;e<s.nbParticles;e++){const t=s.particles[e];t.scaling=z.One(),t.props.state=1,t.materialIndex=0}if(s.setParticles(),s.computeSubMeshes(),this.metadata.inProgress=!0,this.metadata.timer=O,n.parent.scaling=z.One(),i.input.controllers.forEach(t=>{if(t.motionController&&t.motionController.rootMesh){t.motionController.rootMesh.getChildMeshes(!0).forEach(e=>{e.name.includes("Solution-Box")&&(e.scaling=z.Zero(),e.setParent(null))});const n=a.getMeshByName(e.name+"-Solution-Box");n.scaling=new z(.25,.25,.25),n.setParent(t.motionController.rootMesh),n.position=new z(0,.05,-.05),n.rotation=new z(Math.PI/4,Math.PI,0)}}),"Cat"===this.name&&(this.getChildMeshes(!0).forEach(e=>{"Tutorial-Mesh"===e.name&&e.dispose(),"Tutorial-Lines"===e.name&&e.dispose()}),o.isSupported&&!o.get("Cat"))){const e=g({width:960},a);e.setParent(l),e.setText("Aim the laser at the|sculpture and click|to chip away blocks"),e.position=new z(-1,1,-.5),e.name="Tutorial-Mesh",e.billboardMode=L.BILLBOARDMODE_Y;const t=N.CreateLines("Tutorial-Lines2",{points:[new z(-1,1.15,-.5),new z(-.25,1.25,-.2)],colors:[new BABYLON.Color4(0,0,0,1),new BABYLON.Color4(0,0,0,1)],useVertexAlpha:!1},a);t.locallyTranslate(l.position),t.setParent(l)}},l.endGame=function(){this.metadata.inProgress=!1;const{sculpture:e,solution:n,percent:o,mistakes:s,timer:r}=this.metadata,i=e.metadata.sps,d=[];for(let e=0;e<i.nbParticles;e++){const t=i.particles[e];d.push(t.props.state)}if(c.isSupported){const e=t.myStorage.get(l.name);let n=!1;if(!e||e.split("|").length<4)n=!0;else{const[t,a,i,c]=e.split("|");o>parseInt(a,10)&&(n=!0),100===o&&s<parseInt(i,10)&&(n=!0),100===o&&0===s&&r>c&&(n=!0)}n&&c.set(l.name,`${d.join("")}|${o}|${s}|${Math.floor(r)}`)}n.parent.scaling=z.Zero();const p=a.getMeshByName("Timer-Mesh");p&&p.setText("")};const d=N.CreateBox("Pedestal",{height:1.3,width:.4,depth:.4},a);d.checkCollisions=!0,d.position=new z(0,.6,0);const p=m(e,null,a);p.metadata.sps.setMultiMaterial([o,n]),p.position=new z(-1,1.5,0),p.scaling=new z(.5,.5,.5),l.metadata.solution=p;const u=N.CreateBox(e.name+"-Solution-Box",{size:.51},a);u.isPickable=!1,u.position=new z(-1,1.5,0),u.material=new k("box"),u.material.alpha=.5;const w=u.clone(e.name+"-Helper-Box");w.isPickable=!1,w.position.x=0,p.setParent(u);const M=m(y,p.metadata.sps.particles,a);if(M.metadata.sps.setMultiMaterial([o,n]),c.isSupported){const e=c.get(l.name);if(e){const[t,n,o,a]=e.split("|");l.metadata.percent=n,l.metadata.mistakes=o,l.metadata.timer=a,p.parent.scaling=z.Zero();const s=t.split(""),r=M.metadata.sps;for(let e=0;e<r.nbParticles;e++){const t=parseInt(s[e],10);r.particles[e].props.state=t;const{correctState:n}=r.particles[e].props;r.particles[e].scaling=1===t||1===n?z.One():z.Zero(),r.particles[e].materialIndex=0===t&&1===n?1:0}r.computeSubMeshes(),r.setParticles()}}var B;M.scaling=new z(.5,.5,.5),M.position=new z(0,1.5,0),l.metadata.sculpture=M,B=M,Object.assign(B,{getPickedParticle(e){const t=this.metadata.sps,n=t.pickedParticle(e.pickInfo);if(!n)return null;const{idx:o}=n;return t.particles[o]},startInteraction(e,t,n){const o=this.getPickedParticle(e);this.metadata.selectedParticles=this.metadata.selectedParticles||{},this.metadata.selectedParticles[e.event.pointerId]=o;const a=this.metadata.sps;this.metadata.parent.metadata.inProgress&&o&&o.startInteraction&&(o.startInteraction(e,t,n),a.setParticles(),a.computeSubMeshes())},moveInteraction(e,t){const n=this.getPickedParticle(e);if(!n)return;const o=this.metadata.sps;n.moveInteraction&&(n.moveInteraction(e,t),o.setParticles())},endInteraction(e,t){this.metadata.selectedParticles=this.metadata.selectedParticles||{};const n=this.metadata.selectedParticles[e.event.pointerId],o=this.metadata.sps;n&&n.endInteraction&&(n.endInteraction(e,t),o.setParticles()),this.metadata.selectedParticles[e.event.pointerId]=void 0}}),M.metadata.parent=l;const x=M.metadata.sps;for(let e=0;e<x.nbParticles;e++){I(x.particles[e])}x.setParticles();const b=g({},a);b.rotate(z.Right(),Math.PI/8),b.position=new z(0,1,-.3),b.scaling=new z(.7,.7,.7),a.registerBeforeRender(()=>{let{timer:t,counter:n,inProgress:o}=l.metadata;const r=s.getDeltaTime()/1e3;t=Math.max(0,t-r),n-=1;const i=a.getMeshByName("Timer-Mesh");if(o&&i&&i.setText(E(t)),o&&0===t&&l.endGame(),n<=0){let o=t>0?""+E(t):""+e.name;const a=p.metadata.sps,s=M.metadata.sps;let r=0,i=0,c=0;for(let e=0;e<a.nbParticles;e++)0===a.particles[e].props.state?(i+=1,0===s.particles[e].props.state&&(r+=1)):0===s.particles[e].props.state&&(c+=1);const d=Math.floor(r/i*100);o+=`|${d}%`,c&&(o+=`|${c} ${1===c?"mistake":"mistakes"}`),b.setText(o),n=T,100===d&&(zzfx(1,.05,597,.34,.22,.42,0,.71,-5.2,0,9,.08,.2,0,0,0,0,.59,.09,.14),l.endGame(d,c)),l.metadata.percent=d,l.metadata.mistakes=c,l.metadata.timer=t}l.metadata.timer=t,l.metadata.counter=n}),b.setParent(d);const C=f();if(C.position=new z(0,.25,-.1),C.startInteraction=()=>{l.startGame(),C.scaling=new z(.9,.9,1),zzfx(1,.05,239,.04,.09,.29,0,.99,-.9,0,0,0,0,0,0,.1,.05,.91,.08,0)},C.endInteraction=()=>{C.scaling=z.One()},C.setParent(d),"Cat"===e.name&&c&&!c.get("Cat")){const e=g({width:960},a);e.setText("Aim the laser and |click the trigger|to reset and start timer"),e.position=new z(1,1,-.5),e.name="Tutorial-Mesh",e.billboardMode=L.BILLBOARDMODE_Y;N.CreateLines("Tutorial-Lines",{points:[e.position,new z(0,.25,-.2)],colors:[new BABYLON.Color4(0,0,0,1),new BABYLON.Color4(0,0,0,1)],useVertexAlpha:!1},a).setParent(l),e.setParent(l)}else"Skull"===e.name?(M.scaling=new z(2.2,2.2,2.2),M.position=new z(0,1.1,3),d.position.x=-2,u.position.x=-2,w.dispose()):"Ship"===e.name?(M.scaling=new z(8,8,8),M.position=new z(0,4,8),d.position.x=-2,u.position.x=-2,w.dispose()):"Links"===e.name&&(M.scaling=new z(2.2,2.2,2.2),M.position=new z(0,.88,3),d.position.x=-2,u.position.x=-2,w.dispose());return d.setParent(l),u.setParent(l),w.setParent(l),M.setParent(l),l}const{Animation:V,Color3:j,Vector3:D,Mesh:F,Space:G}=BABYLON,$=function(){const e=50*Math.random()+20,t=2*Math.random()*Math.PI;this.position=new D(e*Math.cos(t),0,e*Math.sin(t)),this.getScene().beginAnimation(this,0,50,V.ANIMATIONLOOPMODE_RELATIVE,1*Math.random()+1,$.bind(this))};const{Animation:_,Color3:W,Vector3:U,MeshBuilder:X,Mesh:H,Space:Z}=BABYLON;const{Color3:J,CSG:q,Vector3:Q,HemisphericLight:K,PointLight:ee,StandardMaterial:te,Mesh:ne,MeshBuilder:oe,TransformNode:ae,WebXRState:se}=BABYLON;async function re(e){const{scene:t,engine:n,xrHelper:o,xrDefault:a}=e;new K("light1",new Q(1,1,0),t).groundColor=new J(0,0,0);new ee("light2",new Q(0,25,-1),t).intensity=.3;const s=oe.CreateBox("Sphere",{width:15,height:6.4,depth:15},t);s.position.y=3;const r=q.FromMesh(s),i=oe.CreateBox("Sphere",{width:4,height:3,depth:1},t);i.position=new Q(0,1.5,7.5);const c=oe.CreateBox("Inner-Box",{width:14.8,height:6,depth:14.8},t);c.position=new Q(.05,3,.05),r.subtractInPlace(q.FromMesh(c)),r.subtractInPlace(q.FromMesh(i));const l=oe.CreateCylinder("Cylinder",{height:.2,diameter:30});l.position=new Q(0,-.1,0),l.material=h(J.FromInts(86,176,0));const d=q.FromMesh(l),p=l.clone("Floor-2");p.position=new Q(0,-.1,20),d.unionInPlace(q.FromMesh(p)),p.position=new Q(20,-.1,4),d.unionInPlace(q.FromMesh(p)),r.subtractInPlace(d);const m=r.toMesh("Solid");m.checkCollisions=!0;const f=d.toMesh("Floor",l.material,t);f.checkCollisions=!0,t.addMesh(m),s.dispose(),i.dispose(),c.dispose(),l.dispose(),p.dispose();const y=new J(.004,.608,.991),P=h(y);P.specularColor=y;const A=oe.CreateGround("ocean",{width:1e3,height:1e3},t);A.position.y=-1,e.ocean=A,A.material=P,a.teleportation&&(a.teleportation.addFloorMesh(f),a.teleportation.addFloorMesh(m));(await Y(M,e)).position=new Q(-3,0,5);const S=await Y(B,e);S.position=new Q(6,0,20),S.rotate(Q.Up(),Math.PI/2);(await Y(x,e)).position=new Q(3,0,5);(await Y(b,e)).position=new Q(0,0,20);const I=await Y(C,e);I.position=new Q(15,0,5),I.rotate(Q.Up(),Math.PI/2),async function(e){const{scene:t,engine:n}=e,o=u(w);o.setPivotPoint(new D(.5,0,.5)),o.billboardMode=F.BILLBOARDMODE_Y,o.material.emissiveColor=j.White();const a=new V("wavesAnimation","scaling.z",30,V.ANIMATIONTYPE_FLOAT,V.ANIMATIONLOOPMODE_CYCLE);a.setKeys([{frame:0,value:0},{frame:13,value:.8},{frame:24,value:1},{frame:35,value:.8},{frame:50,value:0}]),o.animations=[],o.animations.push(a),t.addMesh(o);for(let t=0;t<24;t++){const n=o.clone("WaveMesh-"+t);n.parent=e.ocean,$.bind(n)()}o.dispose()}(e);(await async function(e){const{scene:t,engine:n}=e,o=new H("Tramp-Game-Mesh",t),a=X.CreateCylinder("Tramp-Mesh",{diameter:2,height:.25},t);a.position.y=.125,a.setParent(o);const s=X.CreateBox("Jumper-Mesh",{width:.25,depth:.25,height:1},t);s.position.y=.625,s.setParent(o),s.acceleration=-9.8,s.velocity=4.9,s.rotationalVelocity=1.5*Math.PI,t.registerBeforeRender(()=>{const e=n.getDeltaTime()/1e3;s.position.y+=s.velocity*e,s.velocity+=s.acceleration*e,s.position.y-.5<=a.position.y&&(s.velocity=Math.abs(s.velocity)),s.spinning&&s.rotate(U.Forward(),s.rotationalVelocity*e)});const r=X.CreateBox("Rotate-Button",{size:.5},t);return r.position=new U(-1,.25,-1),r.startInteraction=(e,t,n)=>{s.spinning=!0},r.endInteraction=()=>{s.spinning=!1},r.setParent(o),o}(e)).position.y=6.2;const O=g({width:1024,height:500},t);O.position=new Q(0,4.5,7.4),O.scaling=new Q(5,5,1),O.setText("Welcome speed sculptors!|Complete each sculpture in|4:04 without any mistakes|to earn a high score");const T=g({width:1920,height:1080},t);T.position=new Q(-7.34,3,2),T.scaling=new Q(8,8,1),T.rotation=new Q(0,1.5*Math.PI,0),t.registerBeforeRender(()=>{let t="Scoreboard|";t+="Name^Percent^Mistakes^Timer",e.sculptures=e.sculptures||[],e.myStorage.isSupported&&e.sculptures.forEach(n=>{const o=e.myStorage.get(n);if(!o)return;const[a,s,r,i]=o.split("|");a&&(t+=`|${n}^${s}^${r}^${i}`)}),T.setText(t)});const z=zzfxM(...v.song);zzfxP(...z).loop=!0}n(5),n(6);const{Scene:ie,Color3:ce,Vector3:le,UniversalCamera:de,DynamicTexture:pe,StandardMaterial:he,MeshBuilder:ue,PointerEventTypes:me,WebXRState:fe}=BABYLON,ge={sculptures:[],myStorage:new class{constructor(e){this.localStorage=window.localStorage,this.namespace=e||"bbf20",this.isSupported=this.testLocalStorage()}testLocalStorage(){try{return this.set("test","1"),this.remove("test"),!0}catch(e){return!1}}set(e,t){return this.localStorage.setItem(`${this.namespace}-${e}`,t),!0}get(e){return this.localStorage.getItem(`${this.namespace}-${e}`)}remove(e){return this.localStorage.removeItem(`${this.namespace}-${e}`),!0}}},we=async()=>{zzfx(1,.05,239,.04,.09,.29,0,.99,-.9,0,0,0,0,0,0,.1,.05,.91,.08,0),document.getElementById("intro").style.display="none";const e=document.getElementById("renderCanvas");e.style.display="block";const t=new BABYLON.Engine(e,!0);ge.engine=t,t.displayLoadingUI();const n=new ie(t),o=(new ce(.004,.608,.991),new ce(.01,.824,1));n.ambientColor=o,n.clearColor=new ce(.01,.824,1),n.gravity=new le(0,-1.81,0),n.collisionsEnabled=!0,ge.scene=n;const a=ue.CreateSphere("skyBox",{diameter:1e3,segments:100},n),s=new he("skyBox",n);s.backFaceCulling=!1,s.disableLighting=!0,a.infiniteDistance=!0;const r=new pe("SkyTexture",{width:512,height:512},n),i=r.getContext();s.reflectionTexture=r;const c=i.createLinearGradient(0,0,0,512);c.addColorStop(1,o.toHexString()),i.fillStyle=c,i.fillRect(0,0,512,512),r.update(),a.material=s;const l=new de("Camera",new le(0,2.01,-2),n);l.attachControl(e,!0),l.speed=.1,l.angularSensibility=9e3,l.applyGravity=!0,l.ellipsoid=new le(1,1,1),l.checkCollisions=!0,l.minZ=.5;const d=await n.createDefaultXRExperienceAsync();d.input.onControllerAddedObservable.add(e=>{e.onMotionControllerInitObservable.add(e=>{const t=e.getMainComponent();t.isButton()?t.onButtonStateChangedObservable.add(e=>{ge.mainComponentActive=1===e.value}):t.isAxes()&&t.onAxisValueChangedObservable.add(e=>{ge.mainComponentActive=1===e.x||1===e.y}),e.onModelLoadedObservable.add(e=>{const t=g({width:960,height:341},n);t.name="Tutorial-Mesh",t.setText("Press up on the joystick|to aim and teleport|to the pointer location"),t.rotate(le.Right(),Math.PI/4),t.scaling=new le(.25,.25,.25),t.setParent(e.rootMesh),t.position.y=.08;const o=n.getMeshByName("Timer-Mesh");o&&o.dispose();const a=g({width:300,height:160},n);a.name="Timer-Mesh",a.setText(""),a.rotate(le.Right(),2/3*Math.PI),a.scaling=new le(.1,.1,.1),a.setParent(e.rootMesh),a.position=new le(0,.04,.08)})})}),ge.xrDefault=d;const p=d.baseExperience;p.camera.setTransformationFromNonVRCamera(l),ge.xrHelper=p,p.onStateChangedObservable.add(e=>{e===fe.IN_XR&&(p.camera.ellipsoid=new le(1,1,1)),e===fe.NOT_IN_XR&&(l.position.y=2.01)}),p.onInitialXRPoseSetObservable.add(e=>{e.onAfterCameraTeleport.add(e=>{d.input.controllers.forEach(e=>{e.motionController&&e.motionController.rootMesh&&e.motionController.rootMesh.getChildMeshes(!0).forEach(e=>{"Tutorial-Mesh"===e.name&&e.dispose()})})})}),ge.selectedMeshes={},n.onPointerObservable.add(e=>{const{pickInfo:t}=e,{hit:o}=t,{pickedMesh:a}=t;if(o&&a&&a.startInteraction)if(ge.selectedMeshes[e.event.pointerId]=a,p&&p.state===fe.IN_XR){const t=d.pointerSelection.getXRControllerByPointerId(e.event.pointerId);if(!t)return;const n=t.motionController;if(!n)return;a.startInteraction(e,n.rootMesh,ge)}else a.startInteraction(e,n.activeCamera,ge)},me.POINTERDOWN),n.onPointerObservable.add(e=>{const t=ge.selectedMeshes[e.event.pointerId];t&&t.moveInteraction&&t.moveInteraction(e,ge)},me.POINTERMOVE),n.onPointerObservable.add(e=>{const t=ge.selectedMeshes[e.event.pointerId];t&&(t.endInteraction&&t.endInteraction(e,ge),delete ge.selectedMeshes[e.event.pointerId])},me.POINTERUP),n.registerBeforeRender(()=>{l.position.y<0&&(console.log("TOO LOW"),l.position=new le(0,2.01,-2))}),await re(ge),t.hideLoadingUI(),document.addEventListener("keydown",e=>("p"===e.key&&(n.debugLayer.isVisible()?n.debugLayer.hide():n.debugLayer.show()),!1)),t.runRenderLoop(()=>{n.render()}),window.addEventListener("resize",()=>{t.resize()})};window.addEventListener("DOMContentLoaded",()=>{document.getElementById("playButton").onclick=we})}]);